DROP TABLE IF EXISTS product_rating;

CREATE TABLE product_rating
(
	product_rating_id INTEGER GENERATED ALWAYS AS IDENTITY,
  product_id INTEGER NOT NULL,
  rating_5 REAL NOT NULL DEFAULT 0.0,
  votes_number_5 INTEGER NOT NULL DEFAULT 0,
  
	CONSTRAINT pk_product_rating_product_rating_id PRIMARY KEY (product_rating_id),
  CONSTRAINT unq_product_rating_product_id UNIQUE (product_id),
  CONSTRAINT chk_product_rating_rating_5 CHECK (rating_5 >= 0 AND rating_5 <= 5.0),
  CONSTRAINT chk_product_rating_votes_number_5 CHECK (votes_number_5 >= 0),
  CONSTRAINT chk_product_rating_rating_5_votes_number_5 CHECK (rating_5 IS NULL OR votes_number_5 > 0),
  CONSTRAINT fk_product_rating_product_id_product_product_id FOREIGN KEY (product_id) REFERENCES product(product_id)
);

INSERT INTO product_rating(product_id, rating_5, votes_number_5)
     VALUES (1, 3.75, 15), -- 1
            (2, 4.21, 12), -- 2
            (3, 4.32, 10), -- 3
            (4, 4.59, 26), -- 4
            (5, 4.75, 17), -- 5
            (6, 3.99, 18), -- 6
            (7, 4.86, 26), -- 7
            (8, 4.51, 45), -- 8
            (9, 4.67, 12), -- 9
            (10, 3.85, 8), -- 10
            (11, 3.94, 45), -- 11
            (12, 4.58, 13), -- 12
            (13, 4.97, 14), -- 13
            (14, 4.26, 23), -- 14
            (15, 4.51, 14), -- 15
            (16, 3.74, 120), -- 16
            (17, 4.96, 5), -- 17
            (18, 4.32, 12), -- 18
            (19, 4.57, 12), -- 19
            (20, 5.0, 3), -- 20
            (21, 4.5, 78), -- 21
            (22, 4.44, 45), -- 22
            (23, 4.59, 12), -- 23
            (24, 4.87, 49), -- 24
            (25, 4.61, 56), -- 25
            (26, 4.63, 12), -- 26
            (27, 4.88, 47), -- 27
            (28, 4.05, 68), -- 28
            (29, 4.89, 54), -- 29
            (30, 4.6, 29), -- 30
            (31, 4.89, 34), -- 31
            (32, 4.51, 87), -- 32
            (33, 4.32, 96), -- 33
            (34, 4.93, 36), -- 34
            (35, 4.25, 58), -- 35
            (36, 4.81, 57), -- 36
            (37, 4.51, 68), -- 37
            (38, 4.63, 94), -- 38
            (39, 4.58, 57), -- 39
            (40, 4.98, 63), -- 40
            (41, 4.57, 26), -- 41
            (42, 4.34, 59), -- 42
            (43, 4.78, 87), -- 43
            (44, 3.78, 13), -- 44
            (45, 4.51, 48), -- 45
            (46, 4.92, 75), -- 46
            (47, 4.65, 10), -- 47
            (48, 4.57, 9), -- 48
            (49, 4.62, 34), -- 49
            (50, 4.84, 2), -- 50
            (51, 4.87, 68), -- 51
            (52, 4.32, 47), -- 52
            (53, 4.24, 48), -- 53
            (54, 3.97, 27), -- 54
            (55, 4.96, 31), -- 55
            (56, 4.57, 13), -- 56
            (57, 4.68, 2), -- 57
            (58, 4.85, 68), -- 58
            (59, 4.57, 67), -- 59
            (60, 4.96, 10), -- 60
            (61, 4.97, 9), -- 61
            (62, 4.68, 16), -- 62
            (63, 4.87, 18), -- 63
            (64, 4.67, 16), -- 64
            (65, 4.98, 24), -- 65
            (66, 4.91, 34), -- 66
            (67, 4.94, 13), -- 67
            (68, 4.93, 45), -- 68
            (69, 4.97, 26), -- 69
            (70, 4.68, 37), -- 70
            (71, 4.38, 24), -- 71
            (72, 4.31, 10), -- 72
            (73, 4.36, 10), -- 73
            (74, 4.58, 18), -- 74
            (75, 4.87, 16), -- 75
            (76, 4.52, 51), -- 76
            (77, 4.53, 34), -- 77
            (78, 4.38, 57), -- 78
            (79, 4.95, 34), -- 79
            (80, 4.67, 29), -- 80
            (81, 4.62, 68), -- 81
            (82, 4.85, 67), -- 82
            (83, 4.61, 54), -- 83
            (84, 4.69, 94), -- 84
            (85, 4.48, 31), -- 85
            (86, 4.35, 35), -- 86
            (87, 4.67, 28), -- 87
            (88, 4.85, 34), -- 88
            (89, 4.98, 67), -- 89
            (90, 4.87, 62), -- 90
            (91, 4.61, 29), -- 91
            (92, 4.63, 37), -- 92
            (93, 4.67, 28), -- 93
            (94, 4.69, 61), -- 94
            (95, 4.87, 27), -- 95
            (96, 4.96, 4), -- 96
            (97, 4.87, 37), -- 97
            (98, 4.37, 58), -- 98

            (99, 4.56, 37), -- 99
            (100, 4.58, 32), -- 100
            (101, 3.99, 100), -- 101
            (102, 4.89, 18), -- 102
            (103, 4.76, 48), -- 103

            (104, 3.87, 26), -- 104
            (105, 4.59, 34), -- 105
            (106, 4.68, 57), -- 106
            (107, 4.79, 68), -- 107
            (108, 4.78, 61), -- 108
            (109, 4.73, 39), -- 109
            (110, 4.59, 26), -- 110
            (111, 4.89, 37), -- 111
            (112, 4.86, 84), -- 112
            (113, 4.57, 51), -- 113
            (114, 4.38, 39), -- 114
            (115, 4.69, 67), -- 115
            (116, 4.76, 54), -- 116
            (117, 4.81, 92), -- 117
            (118, 4.89, 30), -- 118
            (119, 4.87, 37), -- 119
            (120, 4.65, 18), -- 120
            (121, 4.97, 67), -- 121

            (122, 4.7, 39), -- 122
            (123, 4.8, 48), -- 123
            (124, 4.98, 67), -- 124
            (125, 4.68, 24), -- 125
            (126, 4.19, 26), -- 126
            (127, 4.37, 37), -- 127
            (128, 4.69, 67), -- 128

            (129, 4.87, 64), -- 129
            (130, 4.67, 95), -- 130
            (131, 4.96, 52), -- 131
            (132, 4.38, 53), -- 132
            (133, 4.97, 54), -- 133
            (134, 3.97, 59), -- 134
            (135, 4.69, 67), -- 135

            (136, 4.98, 61), -- 136
            (137, 4.68, 52), -- 137
            (138, 4.79, 67), -- 138
            (139, 4.59, 63), -- 139
            (140, 4.89, 69), -- 140
            (141, 4.98, 94), -- 141
            (142, 4.58, 51), -- 142
            (143, 4.38, 36), -- 143
            (144, 4.18, 61), -- 144
            (145, 4.95, 31), -- 145
            (146, 4.87, 57), -- 146
            (147, 4.68, 48), -- 147
            (148, 4.57, 26), -- 148
            (149, 4.69, 27), -- 149
            (150, 4.87, 59), -- 150
            (151, 4.19, 86), -- 151
            (152, 4.28, 54), -- 152
            (153, 4.62, 67), -- 153
            (154, 4.76, 96), -- 154
            (155, 4.26, 34), -- 155
            (156, 4.38, 57), -- 156
            (157, 4.59, 57), -- 157
            (158, 5.0, 63), -- 158
            (159, 4.28, 13), -- 159
            (160, 4.37, 18), -- 160
            (161, 4.28, 29), -- 161
            (162, 4.39, 56), -- 162
            (163, 5.0, 10), -- 163
            (164, 4.25, 75), -- 164
            (165, 4.25, 62), -- 165
            (166, 4.37, 38), -- 166
            (167, 4.22, 67), -- 167
            (168, 4.68, 39), -- 168
            (169, 4.15, 96), -- 169
            (170, 4.89, 67), -- 170
            (171, 4.57, 34), -- 171
            (172, 4.26, 67), -- 172
            (173, 4.87, 54), -- 173
            (174, 4.86, 67), -- 174
            (175, 4.95, 31), -- 175
            
            (176, 4.87, 61), -- 176
            (177, 4.58, 37); -- 177

SELECT *
  FROM product_rating;